{"version":3,"sources":["../src/dom/analyzer.ts","../src/actions/executor.ts","../src/agent/web-agent.ts","../src/agent/langchain-agent.ts","../src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * DOM Analyzer - Automatically analyzes any webpage and extracts context\r\n * No configuration needed - works universally on any website\r\n */\r\n\r\nexport interface InteractiveElement {\r\n  index: number;\r\n  tagName: string;\r\n  type: string;\r\n  role: string;\r\n  text: string;\r\n  placeholder?: string;\r\n  ariaLabel?: string;\r\n  name?: string;\r\n  id?: string;\r\n  className?: string;\r\n  href?: string;\r\n  value?: string;\r\n  checked?: boolean;\r\n  isVisible: boolean;\r\n  isEnabled: boolean;\r\n  rect: DOMRect;\r\n  xpath: string;\r\n  selector: string;\r\n}\r\n\r\nexport interface PageContext {\r\n  url: string;\r\n  title: string;\r\n  description?: string;\r\n  elements: InteractiveElement[];\r\n  textContent: string;\r\n  forms: FormInfo[];\r\n  tables: TableInfo[];\r\n  links: LinkInfo[];\r\n  headings: HeadingInfo[];\r\n  errors: ErrorInfo[];\r\n}\r\n\r\nexport interface ErrorInfo {\r\n  message: string;\r\n  relatedElementIndex?: number;\r\n}\r\n\r\nexport interface FormInfo {\r\n  index: number;\r\n  action?: string;\r\n  method?: string;\r\n  fields: FormFieldInfo[];\r\n}\r\n\r\nexport interface FormFieldInfo {\r\n  name: string;\r\n  type: string;\r\n  label?: string;\r\n  placeholder?: string;\r\n  required: boolean;\r\n  elementIndex: number;\r\n}\r\n\r\nexport interface TableInfo {\r\n  index: number;\r\n  headers: string[];\r\n  rowCount: number;\r\n  caption?: string;\r\n}\r\n\r\nexport interface LinkInfo {\r\n  text: string;\r\n  href: string;\r\n  elementIndex: number;\r\n}\r\n\r\nexport interface HeadingInfo {\r\n  level: number;\r\n  text: string;\r\n}\r\n\r\n/**\r\n * Interactive element selectors - elements users can interact with\r\n */\r\nconst INTERACTIVE_SELECTORS = [\r\n  'a[href]',\r\n  'button',\r\n  'input:not([type=\"hidden\"])',\r\n  'select',\r\n  'textarea',\r\n  '[role=\"button\"]',\r\n  '[role=\"link\"]',\r\n  '[role=\"menuitem\"]',\r\n  '[role=\"tab\"]',\r\n  '[role=\"checkbox\"]',\r\n  '[role=\"radio\"]',\r\n  '[role=\"switch\"]',\r\n  '[role=\"slider\"]',\r\n  '[role=\"spinbutton\"]',\r\n  '[role=\"textbox\"]',\r\n  '[role=\"combobox\"]',\r\n  '[role=\"listbox\"]',\r\n  '[role=\"option\"]',\r\n  '[onclick]',\r\n  '[tabindex]:not([tabindex=\"-1\"])',\r\n  '[contenteditable=\"true\"]',\r\n].join(',');\r\n\r\nexport class DOMAnalyzer {\r\n  private elementCache: Map<number, Element> = new Map();\r\n  private lastAnalysis: PageContext | null = null;\r\n\r\n  /**\r\n   * Analyze current page and extract all context\r\n   */\r\n  analyze(): PageContext {\r\n    const elements = this.findInteractiveElements();\r\n    \r\n    this.lastAnalysis = {\r\n      url: window.location.href,\r\n      title: document.title,\r\n      description: this.getMetaDescription(),\r\n      elements,\r\n      textContent: this.getMainTextContent(),\r\n      forms: this.analyzeForms(elements),\r\n      tables: this.analyzeTables(),\r\n      links: this.extractLinks(elements),\r\n      headings: this.extractHeadings(),\r\n      errors: this.analyzeErrors(elements),\r\n    };\r\n\r\n    return this.lastAnalysis;\r\n  }\r\n\r\n  /**\r\n   * Get element by index for interaction\r\n   */\r\n  getElement(index: number): Element | null {\r\n    return this.elementCache.get(index) || null;\r\n  }\r\n\r\n  /**\r\n   * Generate human-readable description of the page state\r\n   */\r\n  getStateDescription(): string {\r\n    // Always re-analyze to get fresh state, avoiding stale cache issues\r\n    const ctx = this.analyze();\r\n    \r\n    let description = `# Page: ${ctx.title}\\nURL: ${ctx.url}\\n\\n`;\r\n    \r\n    if (ctx.description) {\r\n      description += `Description: ${ctx.description}\\n\\n`;\r\n    }\r\n\r\n    // Add errors and warnings\r\n    if (ctx.errors.length > 0) {\r\n      description += `##  ERRORS & WARNINGS\\n`;\r\n      ctx.errors.forEach(err => {\r\n        const related = err.relatedElementIndex !== undefined ? ` (related to element [${err.relatedElementIndex}])` : '';\r\n        description += `! ${err.message}${related}\\n`;\r\n      });\r\n      description += '\\n';\r\n    }\r\n\r\n    // Add headings structure\r\n    if (ctx.headings.length > 0) {\r\n      description += `## Page Structure\\n`;\r\n      ctx.headings.slice(0, 10).forEach(h => {\r\n        description += `${'  '.repeat(h.level - 1)}- ${h.text}\\n`;\r\n      });\r\n      description += '\\n';\r\n    }\r\n\r\n    // Add forms\r\n    if (ctx.forms.length > 0) {\r\n      description += `## Forms (${ctx.forms.length})\\n`;\r\n      ctx.forms.forEach((form, i) => {\r\n        description += `Form ${i + 1}:\\n`;\r\n        form.fields.forEach(field => {\r\n          const required = field.required ? ' (required)' : '';\r\n          description += `  - [${field.elementIndex}] ${field.label || field.name || field.type}${required}\\n`;\r\n        });\r\n      });\r\n      description += '\\n';\r\n    }\r\n\r\n    // Add interactive elements\r\n    description += `## Interactive Elements (${ctx.elements.length})\\n`;\r\n    ctx.elements.slice(0, 50).forEach(el => {\r\n      const label = el.ariaLabel || el.text || el.placeholder || el.name || el.tagName;\r\n      const truncated = label.length > 50 ? label.substring(0, 47) + '...' : label;\r\n      \r\n      let extra = '';\r\n      if (el.value && el.value !== label && el.value !== 'on') {\r\n        extra = ` (value: \"${el.value}\")`;\r\n      }\r\n      if (el.type.includes('checkbox') || el.type.includes('radio')) {\r\n        extra = el.checked ? ' [CHECKED]' : ' [UNCHECKED]';\r\n      }\r\n      \r\n      description += `[${el.index}] ${el.type}: ${truncated}${extra}\\n`;\r\n    });\r\n\r\n    if (ctx.elements.length > 50) {\r\n      description += `... and ${ctx.elements.length - 50} more elements\\n`;\r\n    }\r\n\r\n    return description;\r\n  }\r\n\r\n  /**\r\n   * Find all interactive elements on the page\r\n   */\r\n  private findInteractiveElements(): InteractiveElement[] {\r\n    this.elementCache.clear();\r\n    const elements: InteractiveElement[] = [];\r\n    const seen = new Set<Element>();\r\n    \r\n    document.querySelectorAll(INTERACTIVE_SELECTORS).forEach((el) => {\r\n      if (seen.has(el)) return;\r\n      seen.add(el);\r\n\r\n      // Skip hidden elements\r\n      const rect = el.getBoundingClientRect();\r\n      const style = window.getComputedStyle(el);\r\n      const isVisible = rect.width > 0 && \r\n                       rect.height > 0 && \r\n                       style.visibility !== 'hidden' && \r\n                       style.display !== 'none' &&\r\n                       style.opacity !== '0';\r\n\r\n      if (!isVisible) return;\r\n\r\n      const index = elements.length;\r\n      this.elementCache.set(index, el);\r\n\r\n      elements.push({\r\n        index,\r\n        tagName: el.tagName.toLowerCase(),\r\n        type: this.getElementType(el),\r\n        role: el.getAttribute('role') || this.inferRole(el),\r\n        text: this.getElementText(el),\r\n        placeholder: (el as HTMLInputElement).placeholder,\r\n        ariaLabel: el.getAttribute('aria-label') || undefined,\r\n        name: (el as HTMLInputElement).name || undefined,\r\n        id: el.id || undefined,\r\n        className: el.className || undefined,\r\n        href: (el as HTMLAnchorElement).href || undefined,\r\n        value: (el as HTMLInputElement).value || undefined,\r\n        checked: (el as HTMLInputElement).checked || false,\r\n        isVisible: true,\r\n        isEnabled: !(el as HTMLInputElement).disabled,\r\n        rect,\r\n        xpath: this.getXPath(el),\r\n        selector: this.getUniqueSelector(el),\r\n      });\r\n    });\r\n\r\n    return elements;\r\n  }\r\n\r\n  private getElementType(el: Element): string {\r\n    const tag = el.tagName.toLowerCase();\r\n    if (tag === 'input') {\r\n      return `input[${(el as HTMLInputElement).type}]`;\r\n    }\r\n    if (tag === 'a') return 'link';\r\n    if (tag === 'button') return 'button';\r\n    if (tag === 'select') return 'dropdown';\r\n    if (tag === 'textarea') return 'textarea';\r\n    return el.getAttribute('role') || tag;\r\n  }\r\n\r\n  private inferRole(el: Element): string {\r\n    const tag = el.tagName.toLowerCase();\r\n    if (tag === 'a') return 'link';\r\n    if (tag === 'button') return 'button';\r\n    if (tag === 'input') {\r\n      const type = (el as HTMLInputElement).type;\r\n      if (type === 'submit' || type === 'button') return 'button';\r\n      if (type === 'checkbox') return 'checkbox';\r\n      if (type === 'radio') return 'radio';\r\n      return 'textbox';\r\n    }\r\n    if (tag === 'select') return 'combobox';\r\n    if (tag === 'textarea') return 'textbox';\r\n    return 'generic';\r\n  }\r\n\r\n  private getElementText(el: Element): string {\r\n    // Try aria-label first\r\n    const ariaLabel = el.getAttribute('aria-label');\r\n    if (ariaLabel) return ariaLabel;\r\n\r\n    // Try inner text\r\n    const text = el.textContent?.trim();\r\n    if (text && text.length < 100) return text;\r\n\r\n    // Try value for inputs\r\n    const value = (el as HTMLInputElement).value;\r\n    if (value) return value;\r\n\r\n    // Try placeholder\r\n    const placeholder = (el as HTMLInputElement).placeholder;\r\n    if (placeholder) return placeholder;\r\n\r\n    // Try title\r\n    const title = el.getAttribute('title');\r\n    if (title) return title;\r\n\r\n    return el.tagName.toLowerCase();\r\n  }\r\n\r\n  private getXPath(el: Element): string {\r\n    const parts: string[] = [];\r\n    let current: Element | null = el;\r\n\r\n    while (current && current !== document.body) {\r\n      let index = 1;\r\n      let sibling = current.previousElementSibling;\r\n      \r\n      while (sibling) {\r\n        if (sibling.tagName === current.tagName) index++;\r\n        sibling = sibling.previousElementSibling;\r\n      }\r\n\r\n      const tag = current.tagName.toLowerCase();\r\n      parts.unshift(`${tag}[${index}]`);\r\n      current = current.parentElement;\r\n    }\r\n\r\n    return '//' + parts.join('/');\r\n  }\r\n\r\n  private getUniqueSelector(el: Element): string {\r\n    if (el.id) return `#${el.id}`;\r\n    \r\n    const tag = el.tagName.toLowerCase();\r\n    const classes = Array.from(el.classList).slice(0, 2).map(c => CSS.escape(c)).join('.');\r\n    \r\n    if (classes) {\r\n      const selector = `${tag}.${classes}`;\r\n      // Verify the selector is valid and unique\r\n      try {\r\n        if (document.querySelectorAll(selector).length === 1) {\r\n          return selector;\r\n        }\r\n      } catch (e) {\r\n        // Ignore invalid selectors\r\n      }\r\n    }\r\n\r\n    // Fallback to nth-child\r\n    const parent = el.parentElement;\r\n    if (parent) {\r\n      const siblings = Array.from(parent.children);\r\n      const index = siblings.indexOf(el) + 1;\r\n      return `${this.getUniqueSelector(parent)} > ${tag}:nth-child(${index})`;\r\n    }\r\n\r\n    return tag;\r\n  }\r\n\r\n  private getMetaDescription(): string | undefined {\r\n    const meta = document.querySelector('meta[name=\"description\"]');\r\n    return meta?.getAttribute('content') || undefined;\r\n  }\r\n\r\n  private getMainTextContent(): string {\r\n    // Try to get main content area\r\n    const main = document.querySelector('main, article, [role=\"main\"], .content, #content');\r\n    if (main) {\r\n      return main.textContent?.trim().substring(0, 2000) || '';\r\n    }\r\n    return document.body.textContent?.trim().substring(0, 2000) || '';\r\n  }\r\n\r\n  private analyzeForms(elements: InteractiveElement[]): FormInfo[] {\r\n    const forms: FormInfo[] = [];\r\n    \r\n    document.querySelectorAll('form').forEach((form, index) => {\r\n      const fields: FormFieldInfo[] = [];\r\n      \r\n      form.querySelectorAll('input, select, textarea').forEach((field) => {\r\n        const el = field as HTMLInputElement;\r\n        if (el.type === 'hidden') return;\r\n\r\n        // Find associated label\r\n        let label = '';\r\n        if (el.id) {\r\n          const labelEl = document.querySelector(`label[for=\"${el.id}\"]`);\r\n          label = labelEl?.textContent?.trim() || '';\r\n        }\r\n        if (!label && el.parentElement?.tagName === 'LABEL') {\r\n          label = el.parentElement.textContent?.trim() || '';\r\n        }\r\n\r\n        // Find element index\r\n        const elementIndex = elements.findIndex(e => \r\n          this.elementCache.get(e.index) === field\r\n        );\r\n\r\n        fields.push({\r\n          name: el.name || el.id || '',\r\n          type: el.type || el.tagName.toLowerCase(),\r\n          label: label || undefined,\r\n          placeholder: el.placeholder || undefined,\r\n          required: el.required || el.hasAttribute('aria-required'),\r\n          elementIndex,\r\n        });\r\n      });\r\n\r\n      forms.push({\r\n        index,\r\n        action: form.action || undefined,\r\n        method: form.method || undefined,\r\n        fields,\r\n      });\r\n    });\r\n\r\n    return forms;\r\n  }\r\n\r\n  private analyzeTables(): TableInfo[] {\r\n    const tables: TableInfo[] = [];\r\n    \r\n    document.querySelectorAll('table').forEach((table, index) => {\r\n      const headers: string[] = [];\r\n      table.querySelectorAll('th').forEach(th => {\r\n        headers.push(th.textContent?.trim() || '');\r\n      });\r\n\r\n      const caption = table.querySelector('caption')?.textContent?.trim();\r\n      const rowCount = table.querySelectorAll('tr').length;\r\n\r\n      tables.push({ index, headers, rowCount, caption });\r\n    });\r\n\r\n    return tables;\r\n  }\r\n\r\n  private extractLinks(elements: InteractiveElement[]): LinkInfo[] {\r\n    return elements\r\n      .filter(el => el.tagName === 'a' && el.href)\r\n      .map(el => ({\r\n        text: el.text,\r\n        href: el.href!,\r\n        elementIndex: el.index,\r\n      }));\r\n  }\r\n\r\n  private extractHeadings(): HeadingInfo[] {\r\n    const headings: HeadingInfo[] = [];\r\n    document.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(h => {\r\n      const level = parseInt(h.tagName[1]);\r\n      const text = h.textContent?.trim() || '';\r\n      if (text) {\r\n        headings.push({ level, text });\r\n      }\r\n    });\r\n    return headings;\r\n  }\r\n\r\n  private analyzeErrors(elements: InteractiveElement[]): ErrorInfo[] {\r\n    const errors: ErrorInfo[] = [];\r\n    const seenMessages = new Set<string>();\r\n\r\n    const addError = (msg: string, index?: number) => {\r\n      const key = `${msg}-${index}`;\r\n      if (!seenMessages.has(key)) {\r\n        seenMessages.add(key);\r\n        errors.push({ message: msg, relatedElementIndex: index });\r\n      }\r\n    };\r\n\r\n    // 1. Check HTML5 Validity\r\n    elements.forEach(el => {\r\n      const domEl = this.elementCache.get(el.index);\r\n      if (domEl instanceof HTMLInputElement || domEl instanceof HTMLSelectElement || domEl instanceof HTMLTextAreaElement) {\r\n        if (!domEl.validity.valid) {\r\n          addError(`Validation Error: ${domEl.validationMessage}`, el.index);\r\n        }\r\n      }\r\n      \r\n      // 2. Check aria-invalid\r\n      if (domEl?.getAttribute('aria-invalid') === 'true') {\r\n        const errId = domEl.getAttribute('aria-errormessage');\r\n        let msg = 'Invalid input value';\r\n        if (errId) {\r\n          const errEl = document.getElementById(errId);\r\n          if (errEl?.textContent) msg = errEl.textContent.trim();\r\n        }\r\n        addError(msg, el.index);\r\n      }\r\n    });\r\n\r\n    // 3. Check role=\"alert\" (live regions, toast messages)\r\n    document.querySelectorAll('[role=\"alert\"]').forEach(el => {\r\n      const text = el.textContent?.trim();\r\n      const style = window.getComputedStyle(el);\r\n      if (text && style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0') {\r\n        addError(`Alert: ${text}`);\r\n      }\r\n    });\r\n\r\n    // 4. Heuristic: Look for red text close to inputs (often validation errors)\r\n    // This is a bit expensive but useful for non-standard forms\r\n    document.querySelectorAll('span, div, p, label').forEach(el => {\r\n      // Optimization: Skip if too much text\r\n      if (!el.textContent || el.textContent.length > 100) return;\r\n      \r\n      const style = window.getComputedStyle(el);\r\n      const color = style.color; // e.g. \"rgb(255, 0, 0)\"\r\n      \r\n      let isRed = false;\r\n      // Parse RGB\r\n      const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\r\n      if (rgbMatch) {\r\n          const [_, r, g, b] = rgbMatch.map(Number);\r\n          // Red-ish color: R is high, G and B are lower\r\n          // Tailwind red-500 is roughly 239, 68, 68\r\n          if (r > 200 && g < 100 && b < 100) { \r\n             isRed = true;\r\n          }\r\n      } else if (color === 'red') {\r\n          isRed = true;\r\n      }\r\n\r\n      // Check class names commonly used for errors\r\n      const className = (el.className && typeof el.className === 'string') ? el.className : '';\r\n      const isErrorClass = className.includes('error') || \r\n                           className.includes('invalid') || \r\n                           className.includes('warning') ||\r\n                           className.includes('text-red-'); // Tailwind red text\r\n\r\n      if (isRed || isErrorClass) {\r\n         if (style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0') {\r\n             // Only add if it looks like a message\r\n             const text = el.textContent?.trim();\r\n             if (text && text.length > 0) {\r\n                 addError(`Possible Error: ${text}`);\r\n             }\r\n         }\r\n      }\r\n    });\r\n\r\n    return errors;\r\n  }\r\n}\r\n","/**\r\n * Action Executor - Performs actions on any webpage\r\n * Automatically handles clicks, typing, scrolling, navigation\r\n */\r\n\r\nimport type { DOMAnalyzer, InteractiveElement } from '../dom/analyzer';\r\n\r\nexport type ActionType = \r\n  | 'click'\r\n  | 'type'\r\n  | 'clear'\r\n  | 'select'\r\n  | 'scroll'\r\n  | 'hover'\r\n  | 'focus'\r\n  | 'wait'\r\n  | 'navigate'\r\n  | 'goBack'\r\n  | 'goForward'\r\n  | 'refresh'\r\n  | 'done';\r\n\r\nexport interface ActionParams {\r\n  click: { index: number };\r\n  type: { index: number; text: string; clear?: boolean };\r\n  clear: { index: number };\r\n  select: { index: number; value: string };\r\n  scroll: { direction: 'up' | 'down' | 'left' | 'right'; amount?: number };\r\n  hover: { index: number };\r\n  focus: { index: number };\r\n  wait: { ms: number };\r\n  navigate: { url: string };\r\n  goBack: Record<string, never>;\r\n  goForward: Record<string, never>;\r\n  refresh: Record<string, never>;\r\n  done: { reasoning?: string };\r\n}\r\n\r\nexport interface ActionResult {\r\n  success: boolean;\r\n  action: ActionType;\r\n  message: string;\r\n  error?: string;\r\n  elementInfo?: Partial<InteractiveElement>;\r\n}\r\n\r\nexport class ActionExecutor {\r\n  constructor(private analyzer: DOMAnalyzer) {}\r\n\r\n  async execute<T extends ActionType>(\r\n    action: T,\r\n    params: ActionParams[T]\r\n  ): Promise<ActionResult> {\r\n    try {\r\n      switch (action) {\r\n        case 'click':\r\n          return await this.click((params as ActionParams['click']).index);\r\n        case 'type':\r\n          const typeParams = params as ActionParams['type'];\r\n          return await this.type(typeParams.index, typeParams.text, typeParams.clear);\r\n        case 'clear':\r\n          return await this.clear((params as ActionParams['clear']).index);\r\n        case 'select':\r\n          const selectParams = params as ActionParams['select'];\r\n          return await this.select(selectParams.index, selectParams.value);\r\n        case 'scroll':\r\n          const scrollParams = params as ActionParams['scroll'];\r\n          return this.scroll(scrollParams.direction, scrollParams.amount);\r\n        case 'hover':\r\n          return await this.hover((params as ActionParams['hover']).index);\r\n        case 'focus':\r\n          return await this.focus((params as ActionParams['focus']).index);\r\n        case 'wait':\r\n          return await this.wait((params as ActionParams['wait']).ms);\r\n        case 'navigate':\r\n          return this.navigate((params as ActionParams['navigate']).url);\r\n        case 'goBack':\r\n          return this.goBack();\r\n        case 'goForward':\r\n          return this.goForward();\r\n        case 'refresh':\r\n          return this.refresh();\r\n        default:\r\n          return { success: false, action, message: `Unknown action: ${action}` };\r\n      }\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        action,\r\n        message: `Action failed: ${action}`,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      };\r\n    }\r\n  }\r\n\r\n  private async click(index: number): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLElement;\r\n    if (!element) {\r\n      return { success: false, action: 'click', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    // Scroll into view\r\n    element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n    await this.delay(100);\r\n\r\n    // Focus and click\r\n    element.focus();\r\n    element.click();\r\n\r\n    // Dispatch events for better compatibility\r\n    // Skip for native form elements to avoid double-firing or conflicts\r\n    const tag = element.tagName.toLowerCase();\r\n    if (!['input', 'button', 'select', 'textarea'].includes(tag)) {\r\n      element.dispatchEvent(new MouseEvent('mousedown', { bubbles: true }));\r\n      element.dispatchEvent(new MouseEvent('mouseup', { bubbles: true }));\r\n      element.dispatchEvent(new MouseEvent('click', { bubbles: true }));\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      action: 'click',\r\n      message: `Clicked element [${index}]`,\r\n      elementInfo: { index, text: element.textContent?.trim().substring(0, 50) },\r\n    };\r\n  }\r\n\r\n  private async type(index: number, text: string, clear = true): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLInputElement | HTMLTextAreaElement;\r\n    if (!element) {\r\n      return { success: false, action: 'type', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n    await this.delay(50);\r\n    element.focus();\r\n\r\n    // Check input type to decide strategy\r\n    const inputType = element.getAttribute('type') || 'text';\r\n    const directValueTypes = ['date', 'time', 'datetime-local', 'month', 'week', 'color', 'range', 'hidden'];\r\n\r\n    // Handle checkboxes and radios\r\n    if (inputType === 'checkbox' || inputType === 'radio') {\r\n      const shouldCheck = ['true', 'yes', 'on', '1', 'checked'].includes(text.toLowerCase());\r\n      (element as HTMLInputElement).checked = shouldCheck;\r\n      element.dispatchEvent(new Event('change', { bubbles: true }));\r\n      element.dispatchEvent(new Event('input', { bubbles: true }));\r\n      \r\n      return {\r\n        success: true,\r\n        action: 'type',\r\n        message: `${shouldCheck ? 'Checked' : 'Unchecked'} ${inputType} element [${index}]`,\r\n        elementInfo: { index },\r\n      };\r\n    }\r\n\r\n    // For date/time/color inputs, we must set value directly as they have strict format validation\r\n    // and don't support partial values during typing\r\n    if (directValueTypes.includes(inputType)) {\r\n      element.value = text;\r\n      element.dispatchEvent(new Event('input', { bubbles: true }));\r\n      element.dispatchEvent(new Event('change', { bubbles: true }));\r\n      \r\n      return {\r\n        success: true,\r\n        action: 'type',\r\n        message: `Set value \"${text}\" for ${inputType} element [${index}]`,\r\n        elementInfo: { index },\r\n      };\r\n    }\r\n\r\n    if (clear) {\r\n      element.value = '';\r\n      element.dispatchEvent(new Event('input', { bubbles: true }));\r\n    }\r\n\r\n    // Universal robust typing strategy\r\n    // Set value directly to handle Unicode (Vietnamese) and special inputs correctly\r\n    if (clear) {\r\n      element.value = text;\r\n    } else {\r\n      element.value += text;\r\n    }\r\n    \r\n    // Dispatch standard events to notify framework (React/Vue/etc)\r\n    element.dispatchEvent(new Event('input', { bubbles: true }));\r\n    element.dispatchEvent(new Event('change', { bubbles: true }));\r\n    \r\n    // Dispatch key events for listeners that might rely on them (simplified)\r\n    if (text.length > 0) {\r\n      const lastChar = text[text.length - 1];\r\n      element.dispatchEvent(new KeyboardEvent('keydown', { key: lastChar, bubbles: true }));\r\n      element.dispatchEvent(new KeyboardEvent('keyup', { key: lastChar, bubbles: true }));\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      action: 'type',\r\n      message: `Typed \"${text.substring(0, 30)}${text.length > 30 ? '...' : ''}\" into element [${index}]`,\r\n      elementInfo: { index },\r\n    };\r\n  }\r\n\r\n  private async clear(index: number): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLInputElement;\r\n    if (!element) {\r\n      return { success: false, action: 'clear', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    element.focus();\r\n    element.value = '';\r\n    element.dispatchEvent(new Event('input', { bubbles: true }));\r\n    element.dispatchEvent(new Event('change', { bubbles: true }));\r\n\r\n    return { success: true, action: 'clear', message: `Cleared element [${index}]` };\r\n  }\r\n\r\n  private async select(index: number, value: string): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLSelectElement;\r\n    if (!element) {\r\n      return { success: false, action: 'select', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    // Intelligent option matching\r\n    const options = Array.from(element.options);\r\n    let matchedOption = options.find(opt => opt.value === value);\r\n\r\n    if (!matchedOption) {\r\n      // Try case-insensitive value match\r\n      matchedOption = options.find(opt => opt.value.toLowerCase() === value.toLowerCase());\r\n    }\r\n    \r\n    if (!matchedOption) {\r\n       // Try label match (exact)\r\n       matchedOption = options.find(opt => opt.text === value);\r\n    }\r\n    \r\n    if (!matchedOption) {\r\n       // Try label match (case-insensitive)\r\n       matchedOption = options.find(opt => opt.text.toLowerCase() === value.toLowerCase());\r\n    }\r\n    \r\n    if (!matchedOption) {\r\n       // Try partial label match\r\n       matchedOption = options.find(opt => opt.text.toLowerCase().includes(value.toLowerCase()));\r\n    }\r\n\r\n    if (matchedOption) {\r\n      element.value = matchedOption.value;\r\n      element.dispatchEvent(new Event('change', { bubbles: true }));\r\n      element.dispatchEvent(new Event('input', { bubbles: true })); // Some frameworks listen to input\r\n\r\n      return {\r\n        success: true,\r\n        action: 'select',\r\n        message: `Selected \"${matchedOption.text}\" (value: ${matchedOption.value}) in element [${index}]`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: false,\r\n      action: 'select',\r\n      message: `Option \"${value}\" not found in element [${index}]. Available: ${options.map(o => o.text).join(', ')}`,\r\n    };\r\n  }\r\n\r\n  private scroll(direction: 'up' | 'down' | 'left' | 'right', amount = 300): ActionResult {\r\n    const scrollOptions: ScrollToOptions = { behavior: 'smooth' };\r\n    \r\n    switch (direction) {\r\n      case 'up':\r\n        window.scrollBy({ ...scrollOptions, top: -amount });\r\n        break;\r\n      case 'down':\r\n        window.scrollBy({ ...scrollOptions, top: amount });\r\n        break;\r\n      case 'left':\r\n        window.scrollBy({ ...scrollOptions, left: -amount });\r\n        break;\r\n      case 'right':\r\n        window.scrollBy({ ...scrollOptions, left: amount });\r\n        break;\r\n    }\r\n\r\n    return { success: true, action: 'scroll', message: `Scrolled ${direction} by ${amount}px` };\r\n  }\r\n\r\n  private async hover(index: number): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLElement;\r\n    if (!element) {\r\n      return { success: false, action: 'hover', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    element.dispatchEvent(new MouseEvent('mouseenter', { bubbles: true }));\r\n    element.dispatchEvent(new MouseEvent('mouseover', { bubbles: true }));\r\n\r\n    return { success: true, action: 'hover', message: `Hovered over element [${index}]` };\r\n  }\r\n\r\n  private async focus(index: number): Promise<ActionResult> {\r\n    const element = this.analyzer.getElement(index) as HTMLElement;\r\n    if (!element) {\r\n      return { success: false, action: 'focus', message: `Element [${index}] not found` };\r\n    }\r\n\r\n    element.focus();\r\n    return { success: true, action: 'focus', message: `Focused element [${index}]` };\r\n  }\r\n\r\n  private async wait(ms: number): Promise<ActionResult> {\r\n    await this.delay(ms);\r\n    return { success: true, action: 'wait', message: `Waited ${ms}ms` };\r\n  }\r\n\r\n  private navigate(url: string): ActionResult {\r\n    window.location.href = url;\r\n    return { success: true, action: 'navigate', message: `Navigating to ${url}` };\r\n  }\r\n\r\n  private goBack(): ActionResult {\r\n    window.history.back();\r\n    return { success: true, action: 'goBack', message: 'Navigated back' };\r\n  }\r\n\r\n  private goForward(): ActionResult {\r\n    window.history.forward();\r\n    return { success: true, action: 'goForward', message: 'Navigated forward' };\r\n  }\r\n\r\n  private refresh(): ActionResult {\r\n    window.location.reload();\r\n    return { success: true, action: 'refresh', message: 'Page refreshed' };\r\n  }\r\n\r\n  private delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n","/**\r\n * WebAgent - Universal AI agent that works on any webpage\r\n * Just import and use - no configuration needed\r\n */\r\n\r\nimport { DOMAnalyzer, type PageContext } from '../dom/analyzer';\r\nimport { ActionExecutor, type ActionType, type ActionParams, type ActionResult } from '../actions/executor';\r\n\r\nexport interface WebAgentConfig {\r\n  /** LLM API endpoint */\r\n  apiEndpoint?: string;\r\n  /** API key for authentication */\r\n  apiKey?: string;\r\n  /** Model to use (e.g., 'gpt-4', 'claude-3', 'gemini-pro') */\r\n  model?: string;\r\n  /** Custom system prompt */\r\n  systemPrompt?: string;\r\n  /** Enable debug mode */\r\n  debug?: boolean;\r\n  /** Callback when agent performs action */\r\n  onAction?: (action: ActionType, params: unknown, result: ActionResult) => void;\r\n  /** Callback when agent thinks */\r\n  onThink?: (thought: string) => void;\r\n  /** Callback when agent gets page context */\r\n  onContext?: (context: PageContext) => void;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n}\r\n\r\nexport interface AgentAction {\r\n  action: ActionType;\r\n  params: Record<string, unknown>;\r\n  reasoning: string;\r\n}\r\n\r\nconst DEFAULT_SYSTEM_PROMPT = `You are a helpful AI assistant that can interact with web pages.\r\nYou analyze the page context and perform actions to help the user accomplish their goals.\r\n\r\nWhen given a task, you should:\r\n1. Analyze the current page state\r\n2. Decide what action to take\r\n3. Return the action in JSON format\r\n\r\nAvailable actions:\r\n- click: { \"action\": \"click\", \"params\": { \"index\": <element_index> }, \"reasoning\": \"why\" }\r\n- type: { \"action\": \"type\", \"params\": { \"index\": <element_index>, \"text\": \"...\" }, \"reasoning\": \"why\" }\r\n- select: { \"action\": \"select\", \"params\": { \"index\": <element_index>, \"value\": \"...\" }, \"reasoning\": \"why\" }\r\n- scroll: { \"action\": \"scroll\", \"params\": { \"direction\": \"up|down\" }, \"reasoning\": \"why\" }\r\n- wait: { \"action\": \"wait\", \"params\": { \"ms\": 1000 }, \"reasoning\": \"why\" }\r\n- done: { \"action\": \"done\", \"reasoning\": \"task completed because...\" }\r\n\r\nAlways respond with valid JSON. Use element indices from the page context.`;\r\n\r\nexport class WebAgent {\r\n  private analyzer: DOMAnalyzer;\r\n  private executor: ActionExecutor;\r\n  private config: WebAgentConfig;\r\n  private history: ChatMessage[] = [];\r\n  private isRunning = false;\r\n\r\n  constructor(config: WebAgentConfig = {}) {\r\n    this.config = {\r\n      model: 'gpt-4',\r\n      debug: false,\r\n      ...config,\r\n    };\r\n    this.analyzer = new DOMAnalyzer();\r\n    this.executor = new ActionExecutor(this.analyzer);\r\n  }\r\n\r\n  /**\r\n   * Chat with the agent - it will analyze the page and respond\r\n   */\r\n  async chat(message: string): Promise<string> {\r\n    // Add user message\r\n    this.history.push({ role: 'user', content: message });\r\n\r\n    // Analyze current page\r\n    const context = this.analyzer.analyze();\r\n    this.config.onContext?.(context);\r\n\r\n    // Build prompt with page context\r\n    const stateDescription = this.analyzer.getStateDescription();\r\n    const prompt = `Current page state:\\n${stateDescription}\\n\\nUser request: ${message}`;\r\n\r\n    // Get LLM response\r\n    const response = await this.callLLM(prompt);\r\n    \r\n    // Add assistant response\r\n    this.history.push({ role: 'assistant', content: response });\r\n\r\n    return response;\r\n  }\r\n\r\n  /**\r\n   * Execute a task automatically - agent will perform actions until done\r\n   */\r\n  async execute(task: string, maxSteps = 10): Promise<ActionResult[]> {\r\n    if (this.isRunning) {\r\n      throw new Error('Agent is already running');\r\n    }\r\n\r\n    this.isRunning = true;\r\n    const results: ActionResult[] = [];\r\n\r\n    try {\r\n      for (let step = 0; step < maxSteps; step++) {\r\n        // Analyze page\r\n        const context = this.analyzer.analyze();\r\n        this.config.onContext?.(context);\r\n\r\n        // Get next action from LLM\r\n        const stateDescription = this.analyzer.getStateDescription();\r\n        const prompt = step === 0\r\n          ? `Task: ${task}\\n\\nCurrent page:\\n${stateDescription}\\n\\nWhat action should I take first?`\r\n          : `Task: ${task}\\n\\nCurrent page:\\n${stateDescription}\\n\\nPrevious actions: ${results.map(r => r.message).join(', ')}\\n\\nWhat action should I take next?`;\r\n\r\n        const response = await this.callLLM(prompt);\r\n        this.config.onThink?.(response);\r\n\r\n        // Parse action from response\r\n        const action = this.parseAction(response);\r\n        \r\n        if (!action) {\r\n          this.log('Could not parse action from response');\r\n          break;\r\n        }\r\n\r\n        if (action.action === 'done') {\r\n          this.log('Task completed: ' + action.reasoning);\r\n          break;\r\n        }\r\n\r\n        // Execute action\r\n        const result = await this.executor.execute(\r\n          action.action as ActionType,\r\n          action.params as ActionParams[ActionType]\r\n        );\r\n        \r\n        results.push(result);\r\n        this.config.onAction?.(action.action as ActionType, action.params, result);\r\n        this.log(`Action: ${result.message}`);\r\n\r\n        // Wait for page to update\r\n        await this.delay(500);\r\n      }\r\n    } finally {\r\n      this.isRunning = false;\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Perform a single action\r\n   */\r\n  async act<T extends ActionType>(action: T, params: ActionParams[T]): Promise<ActionResult> {\r\n    const result = await this.executor.execute(action, params);\r\n    this.config.onAction?.(action, params, result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get current page context\r\n   */\r\n  getContext(): PageContext {\r\n    return this.analyzer.analyze();\r\n  }\r\n\r\n  /**\r\n   * Get human-readable page description\r\n   */\r\n  getPageDescription(): string {\r\n    return this.analyzer.getStateDescription();\r\n  }\r\n\r\n  /**\r\n   * Stop current execution\r\n   */\r\n  stop(): void {\r\n    this.isRunning = false;\r\n  }\r\n\r\n  /**\r\n   * Clear chat history\r\n   */\r\n  clearHistory(): void {\r\n    this.history = [];\r\n  }\r\n\r\n  private async callLLM(prompt: string): Promise<string> {\r\n    // If no API endpoint, return mock response for testing\r\n    if (!this.config.apiEndpoint || !this.config.apiKey) {\r\n      return this.mockLLMResponse(prompt);\r\n    }\r\n\r\n    const messages = [\r\n      { role: 'system', content: this.config.systemPrompt || DEFAULT_SYSTEM_PROMPT },\r\n      ...this.history,\r\n      { role: 'user', content: prompt },\r\n    ];\r\n\r\n    try {\r\n      const response = await fetch(this.config.apiEndpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this.config.apiKey}`,\r\n        },\r\n        body: JSON.stringify({\r\n          model: this.config.model,\r\n          messages,\r\n          temperature: 0.7,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      return data.choices?.[0]?.message?.content || 'No response';\r\n    } catch (error) {\r\n      this.log('LLM API error: ' + (error instanceof Error ? error.message : error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private mockLLMResponse(prompt: string): string {\r\n    // Simple mock for testing without API\r\n    const lowerPrompt = prompt.toLowerCase();\r\n    \r\n    if (lowerPrompt.includes('click') && lowerPrompt.includes('button')) {\r\n      return '{\"action\": \"click\", \"params\": {\"index\": 0}, \"reasoning\": \"Clicking the first button\"}';\r\n    }\r\n    if (lowerPrompt.includes('search') || lowerPrompt.includes('type')) {\r\n      return '{\"action\": \"type\", \"params\": {\"index\": 0, \"text\": \"test\"}, \"reasoning\": \"Typing in search field\"}';\r\n    }\r\n    if (lowerPrompt.includes('scroll')) {\r\n      return '{\"action\": \"scroll\", \"params\": {\"direction\": \"down\"}, \"reasoning\": \"Scrolling to see more content\"}';\r\n    }\r\n    \r\n    return '{\"action\": \"done\", \"reasoning\": \"I analyzed the page. What would you like me to do?\"}';\r\n  }\r\n\r\n  private parseAction(response: string): AgentAction | null {\r\n    try {\r\n      // Try to extract JSON from response\r\n      const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\r\n      if (jsonMatch) {\r\n        return JSON.parse(jsonMatch[0]);\r\n      }\r\n    } catch {\r\n      this.log('Failed to parse action JSON');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private log(message: string): void {\r\n    if (this.config.debug) {\r\n      console.log(`[WebAgent] ${message}`);\r\n    }\r\n  }\r\n\r\n  private delay(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n","/**\r\n * LangChainWebAgent - Web Agent built on top of LangChain.js\r\n * Uses structured output with Zod schema to ensure consistent action format\r\n */\r\n\r\nimport { z } from 'zod';\r\nimport { DOMAnalyzer, type PageContext } from '../dom/analyzer';\r\nimport { ActionExecutor, type ActionType, type ActionParams, type ActionResult } from '../actions/executor';\r\n\r\n// ============== Zod Schemas for Structured Output ==============\r\n\r\n/**\r\n * Schema for click action\r\n */\r\nexport const ClickActionSchema = z.object({\r\n  action: z.literal('click'),\r\n  index: z.number().describe('The index of the element to click'),\r\n  reasoning: z.string().describe('Why this action is being performed'),\r\n});\r\n\r\n/**\r\n * Schema for type/input action\r\n */\r\nexport const TypeActionSchema = z.object({\r\n  action: z.literal('type'),\r\n  index: z.number().describe('The index of the input element'),\r\n  text: z.string().describe('The text to type into the element'),\r\n  reasoning: z.string().describe('Why this action is being performed'),\r\n});\r\n\r\n/**\r\n * Schema for select dropdown action\r\n */\r\nexport const SelectActionSchema = z.object({\r\n  action: z.literal('select'),\r\n  index: z.number().describe('The index of the select element'),\r\n  value: z.string().describe('The value to select'),\r\n  reasoning: z.string().describe('Why this action is being performed'),\r\n});\r\n\r\n/**\r\n * Schema for scroll action\r\n */\r\nexport const ScrollActionSchema = z.object({\r\n  action: z.literal('scroll'),\r\n  direction: z.enum(['up', 'down']).describe('Direction to scroll'),\r\n  reasoning: z.string().describe('Why this action is being performed'),\r\n});\r\n\r\n/**\r\n * Schema for wait action\r\n */\r\nexport const WaitActionSchema = z.object({\r\n  action: z.literal('wait'),\r\n  ms: z.number().default(1000).describe('Milliseconds to wait'),\r\n  reasoning: z.string().describe('Why this action is being performed'),\r\n});\r\n\r\n/**\r\n * Schema for done/complete action\r\n */\r\nexport const DoneActionSchema = z.object({\r\n  action: z.literal('done'),\r\n  reasoning: z.string().describe('Why the task is considered complete'),\r\n});\r\n\r\n/**\r\n * Union schema for all possible actions - LLM must output one of these\r\n */\r\nexport const WebActionSchema = z.discriminatedUnion('action', [\r\n  ClickActionSchema,\r\n  TypeActionSchema,\r\n  SelectActionSchema,\r\n  ScrollActionSchema,\r\n  WaitActionSchema,\r\n  DoneActionSchema,\r\n]);\r\n\r\n/**\r\n * Schema for multiple actions (for form filling, etc.)\r\n */\r\nexport const WebActionsListSchema = z.object({\r\n  actions: z.array(WebActionSchema).describe('List of actions to perform in order'),\r\n  summary: z.string().describe('Brief summary of what these actions will accomplish'),\r\n});\r\n\r\n// Export types\r\nexport type WebAction = z.infer<typeof WebActionSchema>;\r\nexport type WebActionsList = z.infer<typeof WebActionsListSchema>;\r\nexport type ClickAction = z.infer<typeof ClickActionSchema>;\r\nexport type TypeAction = z.infer<typeof TypeActionSchema>;\r\nexport type SelectAction = z.infer<typeof SelectActionSchema>;\r\nexport type ScrollAction = z.infer<typeof ScrollActionSchema>;\r\nexport type WaitAction = z.infer<typeof WaitActionSchema>;\r\nexport type DoneAction = z.infer<typeof DoneActionSchema>;\r\n\r\n// ============== LangChain Integration ==============\r\n\r\nexport interface LangChainConfig {\r\n  /**\r\n   * LangChain chat model instance \r\n   * Pass in ChatOpenAI, ChatAnthropic, ChatGoogleGenerativeAI, etc.\r\n   */\r\n  model?: unknown; // BaseChatModel from @langchain/core\r\n\r\n  /**\r\n   * Or use simple API config (will create ChatOpenAI internally)\r\n   */\r\n  apiEndpoint?: string;\r\n  apiKey?: string;\r\n  modelName?: string;\r\n\r\n  /**\r\n   * Enable debug logging\r\n   */\r\n  debug?: boolean;\r\n\r\n  /**\r\n   * Callback when action is executed\r\n   */\r\n  onAction?: (action: WebAction, result: ActionResult) => void;\r\n\r\n  /**\r\n   * Callback when action starts (useful for state saving before navigation)\r\n   */\r\n  onActionStart?: (action: WebAction) => void;\r\n\r\n  /**\r\n   * Callback when thinking/reasoning\r\n   */\r\n  onThink?: (thought: string) => void;\r\n\r\n  /**\r\n   * Callback for page context updates\r\n   */\r\n  onContext?: (context: PageContext) => void;\r\n\r\n  /**\r\n   * Max retries for parsing\r\n   */\r\n  maxRetries?: number;\r\n\r\n  /**\r\n   * Whether to use native structured output (if available).\r\n   * Set to false to force prompt engineering (useful for models with partial schema support like Gemini).\r\n   * @default true\r\n   */\r\n  useStructuredOutput?: boolean;\r\n\r\n  /**\r\n   * Custom instructions or skills to guide the agent\r\n   */\r\n  skills?: string;\r\n\r\n  /**\r\n   * Max tokens for LLM response\r\n   */\r\n  maxTokens?: number;\r\n}\r\n\r\n/**\r\n * System prompt optimized for structured output\r\n */\r\nconst STRUCTURED_SYSTEM_PROMPT = `You are a Web Agent AI assistant. Your job is to interact with web pages by outputting structured actions.\r\n\r\nCRITICAL: You MUST respond with valid JSON that matches the expected schema.\r\n\r\nPAGE ELEMENTS are identified by their [index] number. Use this index in your actions.\r\n\r\nAVAILABLE ACTIONS:\r\n1. click - Click on an element\r\n   {\"action\": \"click\", \"index\": 0, \"reasoning\": \"...\"}\r\n\r\n2. type - Enter text into an input field  \r\n   {\"action\": \"type\", \"index\": 0, \"text\": \"Hello\", \"reasoning\": \"...\"}\r\n\r\n3. select - Choose option in a dropdown\r\n   {\"action\": \"select\", \"index\": 0, \"value\": \"option1\", \"reasoning\": \"...\"}\r\n\r\n4. scroll - Scroll the page\r\n   {\"action\": \"scroll\", \"direction\": \"down\", \"reasoning\": \"...\"}\r\n\r\n5. wait - Wait for something to load\r\n   {\"action\": \"wait\", \"ms\": 1000, \"reasoning\": \"...\"}\r\n\r\n6. done - Task is complete\r\n   {\"action\": \"done\", \"reasoning\": \"...\"}\r\n\r\nFor MULTIPLE ACTIONS (like filling a form), respond with:\r\n{\r\n  \"actions\": [\r\n    {\"action\": \"type\", \"index\": 0, \"text\": \"John\", \"reasoning\": \"Fill name field\"},\r\n    {\"action\": \"type\", \"index\": 1, \"text\": \"john@email.com\", \"reasoning\": \"Fill email\"},\r\n    {\"action\": \"click\", \"index\": 2, \"reasoning\": \"Submit form\"}\r\n  ],\r\n  \"summary\": \"Fill and submit the contact form\"\r\n}\r\n\r\nRULES:\r\n- Always use element index from the page context\r\n- Always include reasoning for your actions\r\n- Pay attention to ERRORS & WARNINGS in the page state. If validation errors are present, fix them before proceeding.\r\n- Output valid JSON only - no markdown, no explanation text outside JSON`;\r\n\r\n/**\r\n * LangChain-powered Web Agent with structured output\r\n */\r\nexport class LangChainWebAgent {\r\n  private analyzer: DOMAnalyzer;\r\n  private executor: ActionExecutor;\r\n  private config: LangChainConfig;\r\n  private chatModel: unknown; // Will be typed when LangChain is available\r\n  private history: string[] = [];\r\n  private results: ActionResult[] = [];\r\n  private lastAction: WebAction | null = null;\r\n\r\n  constructor(config: LangChainConfig = {}) {\r\n    this.config = {\r\n      debug: false,\r\n      maxRetries: 3,\r\n      useStructuredOutput: true,\r\n      ...config,\r\n    };\r\n    this.analyzer = new DOMAnalyzer();\r\n    this.executor = new ActionExecutor(this.analyzer);\r\n    this.chatModel = config.model;\r\n  }\r\n\r\n  /**\r\n   * Export current agent state\r\n   */\r\n  exportState(): string {\r\n    return JSON.stringify({\r\n      history: this.history,\r\n      results: this.results\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Import agent state\r\n   */\r\n  importState(stateJson: string): void {\r\n    try {\r\n      const state = JSON.parse(stateJson);\r\n      this.history = state.history || [];\r\n      this.results = state.results || [];\r\n    } catch (e) {\r\n      this.log(`Error importing state: ${e}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the LangChain chat model\r\n   * Use this if you want to configure the model separately\r\n   */\r\n  setModel(model: unknown): void {\r\n    this.chatModel = model;\r\n  }\r\n\r\n  /**\r\n   * Update the agent's skills configuration\r\n   */\r\n  setSkills(skills: string): void {\r\n    this.config.skills = skills;\r\n  }\r\n\r\n  /**\r\n   * Get current page context\r\n   */\r\n  getContext(): PageContext {\r\n    const context = this.analyzer.analyze();\r\n    this.config.onContext?.(context);\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * Get page description for LLM\r\n   */\r\n  getPageDescription(): string {\r\n    return this.analyzer.getStateDescription();\r\n  }\r\n\r\n  /**\r\n   * Execute a single action\r\n   */\r\n  async executeAction(action: WebAction): Promise<ActionResult> {\r\n    // General Loop Detection\r\n    if (this.lastAction && action.action !== 'scroll' && action.action !== 'wait') {\r\n      const cleanA = { ...action, reasoning: '' };\r\n      const cleanB = { ...this.lastAction, reasoning: '' };\r\n      if (JSON.stringify(cleanA) === JSON.stringify(cleanB)) {\r\n        const loopMsg = `Loop detected: You just performed this exact action (${action.action}). Try something else.`;\r\n        this.log(loopMsg);\r\n        return { success: false, action: action.action as any, message: loopMsg };\r\n      }\r\n    }\r\n    this.lastAction = action;\r\n\r\n    // Optimistic history update\r\n    this.history.push(`Action: ${action.action} (executing)`);\r\n    this.config.onActionStart?.(action);\r\n\r\n    let result: ActionResult;\r\n\r\n    try {\r\n      switch (action.action) {\r\n        case 'click':\r\n          result = await this.executor.execute('click', { index: action.index });\r\n          break;\r\n        case 'type':\r\n          result = await this.executor.execute('type', { index: action.index, text: action.text });\r\n          break;\r\n        case 'select':\r\n          result = await this.executor.execute('select', { index: action.index, value: action.value });\r\n          break;\r\n        case 'scroll':\r\n          result = await this.executor.execute('scroll', { direction: action.direction });\r\n          break;\r\n        case 'wait':\r\n          await new Promise(r => setTimeout(r, action.ms || 1000));\r\n          result = { success: true, action: 'wait', message: `Waited ${action.ms || 1000}ms` };\r\n          break;\r\n        case 'done':\r\n          result = { success: true, action: 'done', message: action.reasoning };\r\n          break;\r\n        default:\r\n          result = { success: false, action: 'wait', message: 'Unknown action' };\r\n      }\r\n    } catch (e) {\r\n      result = { success: false, action: action.action as any, message: `Failed: ${e}` };\r\n    }\r\n\r\n    // Update history with final result\r\n    this.history[this.history.length - 1] = `Action: ${action.action} (${result.message})`;\r\n    this.results.push(result);\r\n\r\n    this.config.onAction?.(action, result);\r\n    this.log(`Action: ${action.action} - ${result.message}`);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Execute multiple actions in sequence\r\n   */\r\n  async executeActions(actions: WebAction[]): Promise<ActionResult[]> {\r\n    const results: ActionResult[] = [];\r\n\r\n    for (const action of actions) {\r\n      const result = await this.executeAction(action);\r\n      results.push(result);\r\n\r\n      if (!result.success || action.action === 'done') {\r\n        break;\r\n      }\r\n\r\n      // Small delay between actions\r\n      await new Promise(r => setTimeout(r, 300));\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Chat with the agent using LangChain model\r\n   * Requires @langchain/core to be installed\r\n   */\r\n  async chat(message: string): Promise<{ response: string; actions?: WebAction[] }> {\r\n    const pageContext = this.getPageDescription();\r\n\r\n    // If using LangChain model with structured output\r\n    if (this.chatModel) {\r\n      return this.chatWithLangChain(message, pageContext);\r\n    }\r\n\r\n    // Fallback to simple API call\r\n    return this.chatWithAPI(message, pageContext);\r\n  }\r\n\r\n  /**\r\n   * Execute a task automatically using Planner-Actor architecture\r\n   */\r\n  async execute(task: string, maxSteps = 10, resume = false): Promise<ActionResult[]> {\r\n    if (!resume) {\r\n      this.results = [];\r\n      this.history = [];\r\n    }\r\n\r\n    // Continue from previous step count\r\n    const startStep = this.results.length > 0 ? Math.floor(this.history.length / 2) : 0;\r\n\r\n    for (let step = startStep; step < maxSteps; step++) {\r\n      const pageContext = this.getPageDescription();\r\n\r\n      this.log(`Planning step ${step + 1}`);\r\n\r\n      // Add urgency if running out of steps\r\n      let urgencyInstruction = \"\";\r\n      if (maxSteps - step <= 3) {\r\n        urgencyInstruction = `\\n\\nCRITICAL WARNING: You have ${maxSteps - step} steps remaining. You MUST conclude the task immediately. If you cannot finish, output \"DONE: <summary of what was achieved and what failed>\". Do NOT start new exploration actions.`;\r\n      }\r\n\r\n      try {\r\n        const plannerSystemPrompt = `You are a Browser Agent Planner.\r\nYour goal is to complete the user's task on the current page.\r\n${urgencyInstruction}\r\n\r\n1. CRITICAL: CHECK FOR SUCCESS FIRST.\r\n   - Look for \"Thank you\", \"Order confirmed\", \"Success\", or similar messages.\r\n   - Look for success modals or redirect pages.\r\n   - If success is detected, output exactly: \"DONE\". IGNORE any validation errors if the task is already done.\r\n\r\n2. Analyze the PAGE STATE (especially ERRORS & WARNINGS section) and ACTION HISTORY.\r\n\r\n3. CHECK FOR ERRORS: If there are validation errors or warnings AND the task is NOT done, your next step MUST be to fix them. Do not keep submitting if there are errors.\r\n\r\n4. If NOT COMPLETED and NO ERRORS, provide the NEXT STEP. \r\n   - Group related actions together (e.g. \"Fill all form fields\", \"Enter details and click submit\").\r\n   - Do not break down into single clicks unless necessary.\r\n\r\n5. AMBIGUITY CHECK: If the user request is unclear, ambiguous, or missing critical information, output: \"ASK: <your question>\". IMPORTANT: Do not make up information.\r\n\r\n6. INTERACTIVE COMPLETION: If the task is DONE, instead of just \"DONE\", you can output \"DONE: <summary>\". You can also ask what the user wants to do next.\r\n\r\n7. ANY INFORMATION MISSING: If you lack critical information to proceed (e.g. user details, payment info), output: \"ASK: <your question>\". IMPORTANT: Do not make up information.\r\n\r\n8. ALWAYS keep the USER REQUEST in mind when planning your steps.\r\n\r\n9. IMPORTANT: NEVER perform actions that would SUBMIT or FINALIZE transactions without explicit instruction.\r\n\r\nTask: ${task}\r\n\r\n${this.config.skills ? `ADDITIONAL SKILLS/INSTRUCTIONS:\\n${this.config.skills}` : ''}`;\r\n\r\n        const plannerUserContent = `PAGE STATE:\r\n${pageContext}\r\n\r\nACTION HISTORY:\r\n${this.history.join('\\n')}\r\n\r\nWhat is the next step?`;\r\n\r\n        let plan = '';\r\n\r\n        if (this.chatModel) {\r\n          // Planner Step via LangChain\r\n          // @ts-ignore - Dynamic type for LangChain model\r\n          const planResponse = await this.chatModel.invoke([\r\n            ['system', plannerSystemPrompt],\r\n            ['human', plannerUserContent]\r\n          ]);\r\n          // @ts-ignore\r\n          plan = planResponse.content.toString().trim();\r\n        } else {\r\n          // Planner Step via Custom API\r\n          plan = await this.callAPI([\r\n            { role: 'system', content: plannerSystemPrompt },\r\n            { role: 'user', content: plannerUserContent }\r\n          ], false); // No JSON mode for Planner (text)\r\n        }\r\n\r\n        this.log(`Plan: ${plan}`);\r\n\r\n        if (plan.startsWith('ASK:')) {\r\n          this.log(`Agent Question: ${plan.substring(4).trim()}`);\r\n          // Stop execution to let user respond\r\n          break;\r\n        }\r\n\r\n        if (plan.toUpperCase().startsWith('DONE') || plan.includes('successfully booked')) {\r\n          this.log('Task verified as complete');\r\n          // Save completion to history so it persists across reloads/sessions\r\n          this.history.push(`Completion: ${plan}`);\r\n          if (plan.length > 4) {\r\n            this.log(plan.substring(5).trim());\r\n          }\r\n          break;\r\n        }\r\n\r\n        // Execution Step\r\n        // Pass original task context so Executor knows about constraints (e.g. \"Do not submit\")\r\n        const { actions, response } = await this.chat(`Original Task Context: ${task}\\n\\nExecute this step: ${plan}`);\r\n\r\n        if (actions && actions.length > 0) {\r\n          await this.executeActions(actions);\r\n          // History is updated inside executeAction now\r\n        } else {\r\n          this.history.push(`Observation: ${response}`);\r\n        }\r\n\r\n        // Wait for page updates\r\n        await new Promise(r => setTimeout(r, 1000));\r\n\r\n      } catch (error) {\r\n        this.log(`Planning error: ${error}`);\r\n        // If critical error in planning, maybe try simple execution for remaining steps if it was a model issue?\r\n        // But if API is down, simple execution won't work either.\r\n        // We will just break loop or return what we have.\r\n        break;\r\n      }\r\n    }\r\n\r\n    return this.results;\r\n  }\r\n\r\n  /**\r\n   * Simple ReAct execution loop (Legacy/Fallback)\r\n   */\r\n  private async executeSimple(task: string, maxSteps = 10): Promise<ActionResult[]> {\r\n    const allResults: ActionResult[] = [];\r\n    const history: string[] = [];\r\n\r\n    for (let step = 0; step < maxSteps; step++) {\r\n      const pageContext = this.getPageDescription();\r\n\r\n      this.log(`Planning step ${step + 1}`);\r\n\r\n      try {\r\n        // Planner Step\r\n        // @ts-ignore - Dynamic type for LangChain model\r\n        const planResponse = await this.chatModel.invoke([\r\n          ['system', `You are a Browser Agent Planner.\r\nYour goal is to complete the user's task on the current page.\r\n1. Analyze the PAGE STATE and ACTION HISTORY.\r\n2. VERIFY if the task is already completed based on the state (e.g. success message visible, data updated).\r\n3. If COMPLETED, output exactly: \"DONE\"\r\n4. If NOT COMPLETED, provide the NEXT STEP. \r\n   - Group related actions together (e.g. \"Fill all form fields\", \"Enter details and click submit\").\r\n   - Do not break down into single clicks unless necessary.\r\n\r\nTask: ${task}\r\n\r\n${this.config.skills ? `ADDITIONAL SKILLS/INSTRUCTIONS:\\n${this.config.skills}` : ''}`],\r\n          ['human', `PAGE STATE:\r\n${pageContext}\r\n\r\nACTION HISTORY:\r\n${history.join('\\n')}\r\n\r\nWhat is the next step?`]\r\n        ]);\r\n\r\n        // @ts-ignore\r\n        const plan = planResponse.content.toString().trim();\r\n        this.log(`Plan: ${plan}`);\r\n\r\n        if (plan.toUpperCase().startsWith('DONE') || plan.includes('successfully booked')) {\r\n          this.log('Task verified as complete');\r\n          break;\r\n        }\r\n\r\n        // Execution Step\r\n        // Pass original task context so Executor knows about constraints (e.g. \"Do not submit\")\r\n        const { actions, response } = await this.chat(`Original Task Context: ${task}\\n\\nExecute this step: ${plan}`);\r\n\r\n        if (actions && actions.length > 0) {\r\n          const results = await this.executeActions(actions);\r\n          allResults.push(...results);\r\n          results.forEach(r => history.push(`Action: ${r.action} (${r.message})`));\r\n        } else {\r\n          history.push(`Observation: ${response}`);\r\n        }\r\n\r\n        // Wait for page updates\r\n        await new Promise(r => setTimeout(r, 1000));\r\n\r\n      } catch (error) {\r\n        this.log(`Planning error: ${error}`);\r\n        // Fallback to simple execution for this step if planning fails\r\n        return this.executeSimple(task, maxSteps - step);\r\n      }\r\n    }\r\n\r\n    return allResults;\r\n  }\r\n\r\n\r\n  /**\r\n   * Chat using LangChain model with structured output\r\n   */\r\n  private async chatWithLangChain(message: string, pageContext: string): Promise<{ response: string; actions?: WebAction[] }> {\r\n    try {\r\n      // Dynamic import to support optional LangChain\r\n      const model = this.chatModel as {\r\n        withStructuredOutput?: (schema: unknown) => unknown;\r\n        invoke?: (messages: unknown[]) => Promise<{ content: string }>;\r\n      };\r\n\r\n      // Try structured output if available and enabled\r\n      if (this.config.useStructuredOutput && model?.withStructuredOutput) {\r\n        try {\r\n          const structuredModel = model.withStructuredOutput(WebActionsListSchema);\r\n          const response = await (structuredModel as { invoke: (messages: unknown[]) => Promise<WebActionsList> }).invoke([\r\n            ['system', `${STRUCTURED_SYSTEM_PROMPT}\\n\\n${this.config.skills ? `ADDITIONAL SKILLS:\\n${this.config.skills}` : ''}`],\r\n            ['human', `${pageContext}\\n\\nUser request: ${message}`],\r\n          ]);\r\n\r\n          return {\r\n            response: response.summary,\r\n            actions: response.actions,\r\n          };\r\n        } catch (e) {\r\n          this.log(`Structured output failed, falling back to prompt engineering: ${e}`);\r\n          // Fall through to regular invoke\r\n        }\r\n      }\r\n\r\n      // Fallback to regular invoke and parse\r\n      if (model?.invoke) {\r\n        const response = await model.invoke([\r\n          ['system', `${STRUCTURED_SYSTEM_PROMPT}\\n\\n${this.config.skills ? `ADDITIONAL SKILLS:\\n${this.config.skills}` : ''}`],\r\n          ['human', `${pageContext}\\n\\nUser request: ${message}`],\r\n        ]);\r\n\r\n        const parsed = this.parseActionsFromResponse(response.content);\r\n        return {\r\n          response: parsed.summary || response.content,\r\n          actions: parsed.actions,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      this.log(`LangChain error: ${error}`);\r\n    }\r\n\r\n    return { response: 'LangChain model not properly configured' };\r\n  }\r\n\r\n  /**\r\n   * Helper to call API endpoint\r\n   */\r\n  private async callAPI(messages: any[], jsonMode = false): Promise<string> {\r\n    if (!this.config.apiEndpoint || !this.config.apiKey) {\r\n      throw new Error('API config missing');\r\n    }\r\n\r\n    const response = await fetch(this.config.apiEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${this.config.apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        model: this.config.modelName || 'gpt-4',\r\n        messages,\r\n        temperature: 0.3,\r\n        max_tokens: this.config.maxTokens,\r\n        ...(jsonMode ? { response_format: { type: 'json_object' } } : {}),\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    return data.choices?.[0]?.message?.content || '';\r\n  }\r\n\r\n  /**\r\n   * Simple API call fallback\r\n   */\r\n  private async chatWithAPI(message: string, pageContext: string): Promise<{ response: string; actions?: WebAction[] }> {\r\n    if (!this.config.apiEndpoint || !this.config.apiKey) {\r\n      return this.mockResponse(message);\r\n    }\r\n\r\n    try {\r\n      const content = await this.callAPI([\r\n        { role: 'system', content: `${STRUCTURED_SYSTEM_PROMPT}\\n\\n${this.config.skills ? `ADDITIONAL SKILLS:\\n${this.config.skills}` : ''}` },\r\n        { role: 'user', content: `${pageContext}\\n\\nUser request: ${message}` },\r\n      ], true); // Use JSON mode for Executor\r\n\r\n      const parsed = this.parseActionsFromResponse(content);\r\n      return {\r\n        response: parsed.summary || content,\r\n        actions: parsed.actions,\r\n      };\r\n    } catch (error) {\r\n      this.log(`API error: ${error}`);\r\n      return { response: `Error: ${error}` };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Parse actions from LLM response text\r\n   */\r\n  private parseActionsFromResponse(response: string): { summary?: string; actions?: WebAction[] } {\r\n    for (let retry = 0; retry < (this.config.maxRetries || 3); retry++) {\r\n      try {\r\n        // Try to find JSON in response\r\n        const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\r\n        if (!jsonMatch) continue;\r\n\r\n        const parsed = JSON.parse(jsonMatch[0]);\r\n\r\n        // Check if it's an actions list\r\n        if (parsed.actions && Array.isArray(parsed.actions)) {\r\n          const validated = WebActionsListSchema.safeParse(parsed);\r\n          if (validated.success) {\r\n            return validated.data;\r\n          }\r\n        }\r\n\r\n        // Check if it's a single action\r\n        const singleValidated = WebActionSchema.safeParse(parsed);\r\n        if (singleValidated.success) {\r\n          return {\r\n            summary: singleValidated.data.reasoning,\r\n            actions: [singleValidated.data]\r\n          };\r\n        }\r\n\r\n      } catch (e) {\r\n        this.log(`Parse attempt ${retry + 1} failed`);\r\n      }\r\n    }\r\n\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Mock response for testing without API\r\n   */\r\n  private mockResponse(message: string): { response: string; actions?: WebAction[] } {\r\n    const lower = message.toLowerCase();\r\n\r\n    if (lower.includes('in form') || lower.includes('fill form')) {\r\n      return {\r\n        response: 'in form vi thng tin test',\r\n        actions: [\r\n          { action: 'type', index: 0, text: 'Nguyn Vn A', reasoning: 'in h tn' },\r\n          { action: 'type', index: 1, text: 'test@example.com', reasoning: 'in email' },\r\n          { action: 'type', index: 2, text: '0901234567', reasoning: 'in ST' },\r\n          { action: 'select', index: 3, value: 'support', reasoning: 'Chn ch ' },\r\n          { action: 'type', index: 4, text: 'Tin nhn test', reasoning: 'in ni dung' },\r\n        ],\r\n      };\r\n    }\r\n\r\n    if (lower.includes('click') || lower.includes('submit') || lower.includes('gi')) {\r\n      return {\r\n        response: 'Click vo nt',\r\n        actions: [{ action: 'click', index: 5, reasoning: 'Click submit button' }],\r\n      };\r\n    }\r\n\r\n    return {\r\n      response: 'Phn tch trang thnh cng',\r\n      actions: [{ action: 'done', reasoning: ' phn tch xong trang web' }],\r\n    };\r\n  }\r\n\r\n  private log(message: string): void {\r\n    if (this.config.debug) {\r\n      console.log(`[LangChainWebAgent] ${message}`);\r\n    }\r\n    this.config.onThink?.(message);\r\n  }\r\n}\r\n\r\n// ============== Factory Functions ==============\r\n\r\n/**\r\n * Create agent with OpenAI model\r\n * Requires @langchain/openai to be installed: npm i @langchain/openai\r\n */\r\nexport async function createOpenAIAgent(\r\n  apiKey: string,\r\n  modelName = 'gpt-4',\r\n  options: Partial<LangChainConfig> = {}\r\n): Promise<LangChainWebAgent> {\r\n  try {\r\n    // @ts-ignore - Optional dependency, users need to install @langchain/openai\r\n    const { ChatOpenAI } = await import('@langchain/openai');\r\n    const model = new ChatOpenAI({\r\n      apiKey,\r\n      modelName,\r\n      temperature: 0.3,\r\n      maxTokens: options.maxTokens,\r\n    });\r\n    return new LangChainWebAgent({ model, debug: true, ...options });\r\n  } catch {\r\n    console.warn('@langchain/openai not installed, using API fallback');\r\n    return new LangChainWebAgent({\r\n      apiEndpoint: 'https://api.openai.com/v1/chat/completions',\r\n      apiKey,\r\n      modelName,\r\n      debug: true,\r\n      ...options\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create agent with Anthropic Claude model\r\n * Requires @langchain/anthropic to be installed: npm i @langchain/anthropic\r\n */\r\nexport async function createAnthropicAgent(\r\n  apiKey: string,\r\n  modelName = 'claude-3-sonnet-20240229',\r\n  options: Partial<LangChainConfig> = {}\r\n): Promise<LangChainWebAgent> {\r\n  try {\r\n    // @ts-ignore - Optional dependency, users need to install @langchain/anthropic\r\n    const { ChatAnthropic } = await import('@langchain/anthropic');\r\n    const model = new ChatAnthropic({\r\n      apiKey,\r\n      modelName,\r\n      temperature: 0.3,\r\n      maxTokens: options.maxTokens,\r\n    });\r\n    return new LangChainWebAgent({ model, debug: true, ...options });\r\n  } catch {\r\n    console.warn('@langchain/anthropic not installed');\r\n    return new LangChainWebAgent({ debug: true, ...options });\r\n  }\r\n}\r\n\r\n/**\r\n * Create agent with Google Gemini model\r\n * Requires @langchain/google-genai to be installed: npm i @langchain/google-genai\r\n */\r\nexport async function createGeminiAgent(\r\n  apiKey: string,\r\n  modelName = 'gemini-pro',\r\n  options: Partial<LangChainConfig> = {}\r\n): Promise<LangChainWebAgent> {\r\n  try {\r\n    // @ts-ignore - Optional dependency, users need to install @langchain/google-genai\r\n    const { ChatGoogleGenerativeAI } = await import('@langchain/google-genai');\r\n    const model = new ChatGoogleGenerativeAI({\r\n      apiKey,\r\n      model: modelName,\r\n      temperature: 0.3,\r\n      maxOutputTokens: options.maxTokens,\r\n    });\r\n    // Disable structured output for Gemini by default due to schema compatibility issues (const keyword)\r\n    return new LangChainWebAgent({ model, debug: true, useStructuredOutput: false, ...options });\r\n  } catch {\r\n    console.warn('@langchain/google-genai not installed');\r\n    return new LangChainWebAgent({ debug: true, ...options });\r\n  }\r\n}\r\n\r\n/**\r\n * Create agent with custom OpenAI-compatible API (like MISA AI, Ollama, vLLM)\r\n * Tries to use ChatOpenAI if available to enable Planner capabilities.\r\n */\r\nexport async function createCustomAgent(\r\n  config: {\r\n    apiKey: string;\r\n    baseURL?: string;\r\n    apiEndpoint?: string; // Legacy alias for baseURL\r\n    modelName?: string;\r\n  },\r\n  options: Partial<LangChainConfig> = {}\r\n): Promise<LangChainWebAgent> {\r\n  const baseUrl = config.baseURL || config.apiEndpoint;\r\n\r\n  try {\r\n    // @ts-ignore - Optional dependency\r\n    const { ChatOpenAI } = await import('@langchain/openai');\r\n    const model = new ChatOpenAI({\r\n      apiKey: config.apiKey,\r\n      modelName: config.modelName,\r\n      configuration: {\r\n        baseURL: baseUrl,\r\n      },\r\n      temperature: 0,\r\n      maxTokens: options.maxTokens,\r\n    });\r\n    return new LangChainWebAgent({ model, debug: true, ...options });\r\n  } catch {\r\n    console.warn('@langchain/openai not installed, using API fallback (No Planner support)');\r\n    return new LangChainWebAgent({\r\n      apiEndpoint: baseUrl,\r\n      apiKey: config.apiKey,\r\n      modelName: config.modelName,\r\n      debug: true,\r\n      ...options\r\n    });\r\n  }\r\n}\r\n","/**\r\n * web-agent-sdk - Universal Web Agent SDK\r\n * AI-powered browser automation that works on any webpage\r\n * \r\n * @example\r\n * ```typescript\r\n * import { WebAgent } from 'web-agent-sdk';\r\n * \r\n * const agent = new WebAgent({\r\n *   apiKey: 'your-api-key',\r\n *   apiEndpoint: 'https://api.openai.com/v1/chat/completions'\r\n * });\r\n * \r\n * // Chat with the agent\r\n * const response = await agent.chat('What can you see on this page?');\r\n * \r\n * // Or execute a task automatically\r\n * await agent.execute('Fill out the contact form with my info');\r\n * ```\r\n */\r\n\r\n// Core exports\r\nexport { WebAgent, type WebAgentConfig, type ChatMessage, type AgentAction } from './agent/web-agent';\r\n\r\n// DOM Analysis\r\nexport { DOMAnalyzer, type PageContext, type InteractiveElement, type FormInfo, type TableInfo, type LinkInfo, type HeadingInfo } from './dom/analyzer';\r\n\r\n// Actions\r\nexport { ActionExecutor, type ActionType, type ActionParams, type ActionResult } from './actions/executor';\r\n\r\n// LangChain Agent with Structured Output\r\nexport {\r\n  LangChainWebAgent,\r\n  type LangChainConfig,\r\n  type WebAction,\r\n  type WebActionsList,\r\n  // Zod Schemas for validation\r\n  WebActionSchema,\r\n  WebActionsListSchema,\r\n  ClickActionSchema,\r\n  TypeActionSchema,\r\n  SelectActionSchema,\r\n  ScrollActionSchema,\r\n  WaitActionSchema,\r\n  DoneActionSchema,\r\n  // Factory functions\r\n  createOpenAIAgent,\r\n  createAnthropicAgent,\r\n  createGeminiAgent,\r\n  createCustomAgent,\r\n} from './agent/langchain-agent';\r\n\r\n// Re-export WebAgent as default\r\nimport { WebAgent } from './agent/web-agent';\r\nexport default WebAgent;\r\n"]}